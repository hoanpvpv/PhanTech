<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi tiết sản phẩm - Công ty PhanTech</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/assets/fonts/themify-icons-font/themify-icons/themify-icons.css">
    <style>
        .product-detail-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            padding: 20px;
        }

        .product-images {
            flex: 1;
            min-width: 300px;
            max-width: 500px;
        }

        .main-image img {
            width: 100%;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
        }

        .thumbnail-images {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
            overflow: hidden;
        }

        .thumbnail-images img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border: 1px solid #ddd;
            cursor: pointer;
            border-radius: 3px;
        }

        .thumbnail-images img:hover {
            border-color: #007bff;
        }

        .product-info {
            flex: 2;
            min-width: 300px;
        }

        .product-title {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .product-rating {
            color: #f39c12;
            margin-bottom: 10px;
        }

        .product-price {
            font-size: 1.5rem;
            color: #e74c3c;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .product-actions {
            margin-top: 20px;
        }

        .btn-buy {
            background-color: #e74c3c;
            color: white;
            padding: 10px 20px;
            font-size: 1.2rem;
        }

        .btn-add-cart {
            background-color: #f39c12;
            color: white;
            padding: 10px 20px;
            font-size: 1.2rem;
        }

        .video-wrapper {
            position: relative;
            padding-bottom: 28.125%;
            height: 0;
            margin: 20px 0;
            max-width: 50%;
        }

        .video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .sidebar-section {
            flex: 1;
            min-width: 200px;
            max-width: 300px;
            background: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .sidebar-section h4 {
            margin-bottom: 15px;
        }

        .similar-product {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .similar-product img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            margin-right: 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }

        .similar-product a {
            text-decoration: none;
            color: #333;
            font-size: 0.9rem;
        }

        .similar-product a:hover {
            color: #007bff;
        }

        .back-btn {
            margin-bottom: 20px;
        }

        .image-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1050;
            justify-content: center;
            align-items: center;
        }

        .image-modal img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }

        .modal-nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.7);
            border: none;
            padding: 10px;
            font-size: 24px;
            cursor: pointer;
        }

        .modal-prev {
            left: 20px;
        }

        .modal-next {
            right: 20px;
        }

        @media (max-width: 768px) {
            .sidebar-section {
                margin-top: 20px;
            }
        }
    </style>
</head>

<body>
    <div class="scale-wrapper">
        <div id="nav-container"></div>
        <main style="background-color: #f8f9fa;">
            <div class="container my-5">
                <div class="row">
                    <div class="col-lg-9">
                        <a href="/pages/products.html" class="btn btn-secondary back-btn">Quay lại danh sách sản
                            phẩm</a>
                        <div class="product-detail-container">
                            <div class="product-images">
                                <div class="main-image">
                                    <img id="main-image" src="/assets/images/homelift.png" alt="Main Product Image">
                                </div>
                                <div class="thumbnail-images" id="thumbnail-images"></div>
                            </div>
                            <div class="product-info">
                                <h1 class="product-title" id="product-title"></h1>
                                <div class="product-rating">★★★★☆ (5 đánh giá)</div>
                                <div class="product-price" id="product-price"></div>
                                <p><strong>Tải trọng:</strong> <span id="load-capacity"></span></p>
                                <p><strong>Tốc độ:</strong> <span id="speed"></span></p>
                                <p><strong>Kích thước cabin:</strong> <span id="cabin-size"></span></p>
                                <p><strong>Công suất động cơ:</strong> <span id="motor-power"></span></p>
                                <div class="product-actions">
                                    <button class="btn btn-add-cart mt-3 px-5 py-2 fw-bold shadow-sm">Thêm vào danh sách
                                        yêu cầu</button>
                                    <a href="/pages/contact.html"
                                        class="btn btn-primary mt-3 px-5 py-2 fw-bold shadow-sm">Liên hệ ngay</a>
                                </div>
                            </div>
                        </div>
                        <div class="mt-5">
                            <h3>Mô tả sản phẩm</h3>
                            <p id="description"></p>
                            <p><strong>Vật liệu chính:</strong> <span id="material"></span></p>
                            <p><strong>Tính năng đặc biệt:</strong> <span id="special-features"></span></p>
                            <div class="video-wrapper">
                                <iframe id="product-video" frameborder="0" allowfullscreen></iframe>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="sidebar-section">
                            <h4 class="text-primary">Loại thang máy</h4>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item"><a href="#homelift"
                                        class="text-decoration-none text-dark">Thang máy gia đình</a></li>
                                <li class="list-group-item"><a href="#passenger"
                                        class="text-decoration-none text-dark">Thang máy chở khách</a></li>
                                <li class="list-group-item"><a href="#glass"
                                        class="text-decoration-none text-dark">Thang máy kính</a></li>
                                <li class="list-group-item"><a href="#hydraulic"
                                        class="text-decoration-none text-dark">Thang máy thủy lực</a></li>
                                <li class="list-group-item"><a href="#freight"
                                        class="text-decoration-none text-dark">Thang máy hàng hóa</a></li>
                                <li class="list-group-item"><a href="#hospital"
                                        class="text-decoration-none text-dark">Thang máy bệnh viện</a></li>
                            </ul>
                        </div>
                        <div class="sidebar-section">
                            <h4 class="text-primary">Sản phẩm tương tự</h4>
                            <div id="similar-products"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <div class="image-modal" id="image-modal">
            <img id="modal-image" src="" alt="Zoomed Image">
            <button class="modal-nav-btn modal-prev ti-arrow-left" id="modal-prev"></button>
            <button class="modal-nav-btn modal-next ti-arrow-right" id="modal-next"></button>
        </div>
        <div id="footer-container"></div>
        <div id="cart-container"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="../cart.js"></script>
    <script>
        async function loadComponent(containerId, filePath) {
            try {
                const response = await fetch(filePath);
                if (!response.ok) throw new Error(`Không tải được ${filePath}`);
                const content = await response.text();
                document.getElementById(containerId).innerHTML = content;

                // Khởi tạo cart sau khi component cart được tải
                if (containerId === 'cart-container') {
                    console.log('Đã tải xong cart-container');
                    if (typeof initCart === 'function') {
                        console.log('Hàm initCart có sẵn, khởi tạo cart');
                        setTimeout(initCart, 200);
                    } else {
                        console.error('Hàm initCart chưa sẵn sàng');
                        // Thử tải lại cart.js
                        const script = document.createElement('script');
                        script.src = '../cart.js';
                        script.onload = () => {
                            console.log('Đã tải lại cart.js');
                            setTimeout(initCart, 200);
                        };
                        document.body.appendChild(script);
                    }
                }
            } catch (error) {
                console.error(error);
            }
        }

        loadComponent('nav-container', '/component/nav.html');
        loadComponent('footer-container', '/component/footer.html');
        loadComponent('cart-container', '/component/cart.html');

        let currentImages = [];
        let currentImageIndex = 0;

        async function loadProductDetail() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const productTitle = urlParams.get('title');
                const response = await fetch('/pages/products.json');
                if (!response.ok) throw new Error('Không tải được products.json');
                const products = await response.json();
                const product = products.find(p => p.name === productTitle);

                if (product) {
                    document.getElementById('product-title').textContent = product.name;
                    document.getElementById('product-price').textContent = product.estimatedPrice;
                    document.getElementById('load-capacity').textContent = product.loadCapacity;
                    document.getElementById('speed').textContent = product.speed;
                    document.getElementById('cabin-size').textContent = product.cabinSize;
                    document.getElementById('motor-power').textContent = product.motorPower;
                    document.getElementById('description').textContent = product.description;
                    document.getElementById('material').textContent = product.material;
                    document.getElementById('special-features').textContent = product.specialFeatures;
                    document.getElementById('product-video').src = product.video;

                    currentImages = product.images;
                    document.getElementById('main-image').src = product.images[0];
                    const thumbnailContainer = document.getElementById('thumbnail-images');
                    product.images.forEach((imgSrc, index) => {
                        const img = document.createElement('img');
                        img.src = imgSrc;
                        img.alt = `${product.name} thumbnail ${index + 1}`;
                        img.onclick = () => {
                            document.getElementById('main-image').src = imgSrc;
                            openImageModal(index);
                        };
                        thumbnailContainer.appendChild(img);
                    });

                    document.getElementById('main-image').onclick = () => openImageModal(0);

                    const similarProducts = products.filter(p => p.type === product.type && p.name !== product.name).slice(0, 5);
                    const similarContainer = document.getElementById('similar-products');
                    similarProducts.forEach(similar => {
                        const similarItem = `
                            <div class="similar-product">
                                <img src="${similar.images[0]}" alt="${similar.name}">
                                <a href="/pages/product-detail.html?title=${encodeURIComponent(similar.name)}">${similar.name}</a>
                            </div>
                        `;
                        similarContainer.innerHTML += similarItem;
                    });

                    document.querySelector('.btn-add-cart').onclick = () => {
                        if (typeof window.addToCart === 'function') {
                            window.addToCart(product);
                            // Đảm bảo cart-content hiển thị
                            const cartContent = document.getElementById('cart-content');
                            if (cartContent) {
                                cartContent.classList.add('show');
                                console.log('Đã thêm class show vào cart-content');
                            } else {
                                console.error('Không tìm thấy phần tử cart-content');
                            }
                        } else {
                            console.error('addToCart chưa được định nghĩa. Đảm bảo cart.js đã tải.');
                            alert('Có lỗi xảy ra. Vui lòng thử lại sau!');
                        }
                    };

                    // Cập nhật nút "Liên hệ ngay" để truyền thông tin sản phẩm
                    const contactBtn = document.querySelector('.btn-primary');
                    contactBtn.href = `/pages/contact.html?product=${encodeURIComponent(product.name)}`;

                } else {
                    document.querySelector('.product-info').innerHTML = '<p>Sản phẩm không tồn tại.</p>';
                }
            } catch (error) {
                console.error(error);
                document.querySelector('.product-info').innerHTML = '<p>Lỗi: Không tải được dữ liệu sản phẩm.</p>';
            }
        }

        const modal = document.getElementById('image-modal');
        const modalImage = document.getElementById('modal-image');
        const prevBtn = document.getElementById('modal-prev');
        const nextBtn = document.getElementById('modal-next');

        function openImageModal(index) {
            currentImageIndex = index;
            modalImage.src = currentImages[currentImageIndex];
            modal.style.display = 'flex';
        }

        function closeImageModal() {
            modal.style.display = 'none';
        }

        prevBtn.onclick = () => {
            currentImageIndex = (currentImageIndex - 1 + currentImages.length) % currentImages.length;
            modalImage.src = currentImages[currentImageIndex];
        };

        nextBtn.onclick = () => {
            currentImageIndex = (currentImageIndex + 1) % currentImages.length;
            modalImage.src = currentImages[currentImageIndex];
        };

        modal.onclick = (e) => {
            if (e.target === modal) closeImageModal();
        };

        document.addEventListener('DOMContentLoaded', loadProductDetail);
    </script>
</body>

</html>